<?xml version="1.0" encoding="UTF-8"?>
<d:document xmlns="http://www.w3.org/1999/xhtml"
		  xmlns:d="http://cssbox.sourceforge.net/docs">
<d:title>CSSBox Manual</d:title>
<d:author>Radek Burget<br/>
<a href="mailto:burgetr@fit.vutbr.cz">burgetr@fit.vutbr.cz</a>
</d:author>

<d:toc />

<d:section id="intro">
<d:title>Introduction</d:title>
<p>CSSBox is an (X)HTML/CSS rendering engine written in pure Java. Its 
primary purpose is to provide a complete and further processable information 
about the rendered page contents and layout.</p>
<p>This manual gives a short overview of the CSSBox usage. It shows how to
render a document and it explains how the resulting page is represented and
how the basic information about the individual parts can be obtained.</p>
<p>More detailed information about the individual classes can be obtained
from the <d:api>API documentation</d:api>.</p>
<p>Any feedback to CSSBox and/or this manual is welcome via the
<a href="http://cssbox.sourceforge.net/">CSSBox website</a>.</p>
</d:section>

<d:section title="Basic usage" id="basic">
<d:title>Basic usage</d:title>
<p>The input of the rendering engine is a document DOM tree. The engine is able to
automatically load the style sheets referenced in the document and it computes the
efficient style of each element. Afterwrads, the document layout is computed.</p>

<d:subsection id="basicLoading">
<d:title>Document Loading</d:title>
<p>In the examples, the <a href="http://jtidy.sourceforge.net/">JTidy</a> HTML parser
is used. However, any other DOM parser can be used. For creating the DOM tree using
JTidy, following code can be used:</p> 
<d:codebox>
<br/>Tidy tidy = new Tidy();
<br/>tidy.setTrimEmptyElements(false);
<br/>tidy.setInputEncoding("utf-8");
<br/>Document doc = tidy.parseDOM(is, null);
</d:codebox>>
<p>Note that JTidy has many configuration options that can be found in the
documentation</p>
<p>For the initial DOM and style sheet processing, a
<d:api class="org/fit/cssbox/css/DOMAnalyzer">DOMAnalyzer</d:api> object is used:</p>
<d:codebox>
<br/>DOMAnalyzer da = new DOMAnalyzer(doc, url);
<br/>da.addStyleSheet(null, CSSNorm.stdStyleSheet()); <em>//use the standard style sheet</em>
<br/>da.addStyleSheet(null, CSSNorm.userStyleSheet()); <em>//use the additional style sheet</em>
<br/>da.getStyleSheets(); <em>//load the author style sheets</em>
<br/>da.attributesToStyles(); <em>//convert the HTML presentation attributes to inline styles</em>
</d:codebox>
<p>The <code>addStyleSheet()</code> method is used to add a style sheet to the document
where the style sheet is a text string containing a CSS code. In our case we add two
built-in style sheets that represent the standard document style. The <code>CSSNorm.stdStyleSheet()</code>
method returns the CSS default style sheet and <code>CSSNorm.userStyleSheet()</code> contains some
internal CSSBox modifications of the standard.</p>
<p>The <code>getStyleSheets()</code> method loads and processes all the internal and external
style sheets referenced from the document. In case of external style sheets, CSSBox tries to obtain
the file from the corresponding URL, if accessible.</p>
<p>Finally, the <code>attributesToStyles()</code> converts some HTML presentation attributes to CSS
styles (e.g. the <d:tag>font</d:tag> tag attributes, table attributes and some more. If the HTML
attributes need not be interpreted, this method need not be called.</p> 
<p>The resulting <code>DOMAnalyzer</code> object represents the document code together with the
associated style.</p>
</d:subsection>

<d:subsection id="basicLayout">
<d:title>Obtaining the Layout</d:title>
<p>The whole layout engine is represented by a graphical
<d:api class="org/fit/cssbox/layout/BrowserCanvas">BrowserCanvas</d:api> object. The layout is
computed automatically by creating an instance of this object. The constructor arguments are
the root DOM element (normally, it is the <d:tag>body</d:tag> element), the DOMAnalyzer used
for obtaining the element styles, the initial viewport dimensions and the document base URL used
for loading images and other referenced content.</p>
<d:codebox>
<br/>BrowserCanvas browser = new BrowserCanvas(da.getBody(), da, new java.awt.Dimension(1000, 600), url);
</d:codebox>
</d:subsection>
<p>The created <code>browser</code> object can be directly used for both displaying
the rendered document and for obtaining the created layout model.</p>

<d:subsection id="basicDisplay">
<d:title>Displaying the document</d:title>
<p>The <d:api class="org/fit/cssbox/layout/BrowserCanvas">BrowserCanvas</d:api> class is
directly derived from the Swing <code>javax.swing.JPanel</code> class. Therefore, it can
be directly used as a Swing user interface component. The size of the component is
automatically adjusted according to the resulting document layout. The basic document
displaying is shown in the <d:api class="org/fit/cssbox/demo/SimpleBrowser">SimpleBrowser</d:api>
example.</p>
</d:subsection>

</d:section> 

<d:section id="model">
<d:title>Rendered Document Model</d:title>
<p>The resulting document layout is represented as a tree of <dfn>boxes</dfn>. Each box
creates a rectangular area in the resulting page and it corresponds to a particular
rendered HTML element. There may be multiple boxes corresponding to a single element;
e.g. a multi-line paragraph <d:tag>p</d:tag> is split to several line boxes. A box may be
either composed from child boxes or it may correspond to a particular part of the
document content, which may be a text string or replaced content (e.g. images).</p>
<p>Each box is represented by an object which extends the
<d:api class="org/fit/cssbox/layout/Box">Box</d:api> abstract class. There exist
several box types that roughly correspond to the computed value of the CSS <code>display</code>
property for the corresponding element. Figure 1 shows the type hierarchy of boxes.</p>

<d:fig index="1" title="Box type hierarchy" src="box_classes.png" />

<p>The root node of the box tree is always represented by a
<d:api class="org/fit/cssbox/layout/Viewport">Viewport</d:api> object and it represents
the browser viewport. It has always a single child which is called a <dfn>root box</dfn>.
The root box corresponds to the root element of the HTML code passed to the
<d:api class="org/fit/cssbox/layout/BrowserCanvas">BrowserCanvas</d:api> for rendering.
Usually, it is the <d:tag>body</d:tag> element.</p>

<p>The viewport and the root box are obtained using the
<d:api class="org/fit/cssbox/layout/BrowserCanvas" anchor="getViewport()">getViewport()</d:api> and
<d:api class="org/fit/cssbox/layout/BrowserCanvas" anchor="getRootBox()">getRootBox()</d:api> methods
of the BrowserCanvas.</p>

<p>In the following chapters, we will mention the most important methods that
can be used for obtaining information about the resulting document layout. For
other methods, see the <d:api>CSSBox API reference</d:api>.</p>

<d:subsection id="modelBox">
<d:title>Basic Box Properties</d:title>
<p>The basic box properties are defined in the <d:api class="org/fit/cssbox/layout/Box">Box</d:api>
abstract class. They are mostly related to the box position and size.</p>

	<d:subsubsection id="boxPositions">
	<d:title>Box Position and Size</d:title>
	<p>During the layout, the box position is first computed relatively to the containing box and
	in the next step, the absolute position in the page is computed. The box occupies a rectangular
	area in the page which includes the box contents, borders and margins. The contents of the box
	is always inside of this area and it is again a rectangle which is equal or smaller than the whole box.
	Following methods can be used for obtaining the positions and sizes:</p>
	<dl>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getAbsoluteBounds()">getAbsoluteBounds()</d:api></dt>
		<dd>Returns the absolute box position and size on the page including all the borders
		and margins. The result is the <code>java.awt.Rectangle</code> object.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getBounds()">getBounds()</d:api></dt>
		<dd>Returns the box position and size relatively to the top-left corner of the containing block.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getAbsoluteContentX()">getAbsoluteContentX()</d:api></dt>
		<dd>The absolute X coordinate of the top left corner of the box contents.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getAbsoluteContentY()">getAbsoluteContentY()</d:api></dt>
		<dd>The absolute Y coordinate of the top left corner of the box contents.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getContentX()">getContentX()</d:api></dt>
		<dd>The absolute X coordinate of the top left corner of the box contents relatively to the containing block.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getContentY()">getContentY()</d:api></dt>
		<dd>The absolute Y coordinate of the top left corner of the box contents relatively to the containing block.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getContentWidth()">getContentWidth()</d:api></dt>
		<dd>The width of the box content without any margins and borders.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getContentHeight()">getContentHeight()</d:api></dt>
		<dd>The height of the box content without any margins and borders.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor=""></d:api></dt>
		<dd></dd>
	</dl>
	</d:subsubsection>
	
	<d:subsubsection id="boxStructure">
	<d:title>Box Tree Structure</d:title>
	<dl>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getParent()">getParent()</d:api></dt>
		<dd>Returns the parent box of this box or <code>null</code> if this is the root box.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getContainingBlock()">getContainingBlock()</d:api></dt>
		<dd>Returns the containing block for this box.</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getViewport()">getViewport()</d:api></dt>
		<dd>The corresponding <d:api class="org/fit/cssbox/layout/Viewport">Viewport</d:api>
		object (the root of the box tree).</dd>
		<dt><d:api class="org/fit/cssbox/layout/Box" anchor="getNode()">getNode()</d:api></dt>
		<dd>The DOM node this box corresponds to. There may be multiple boxes
		corresponding to a single DOM node.</dd>
	</dl>
	</d:subsubsection>

</d:subsection>

<d:subsection id="modelText">
<d:title>Text Boxes</d:title>
<p>A text box always box corresponds to a DOM node of the type <code>Text</code>. It is represented
as <d:api class="org/fit/cssbox/layout/TextBox">TextBox</d:api> object. When the text is split to
several lines, multiple boxes correspond to a single DOM node. In this case each of them contains
a corresponding substring of the text.</p>

	<d:subsubsection id="textText">
	<d:title>Obtaining the Text Content</d:title>
	<dl>
		<dt><d:api class="org/fit/cssbox/layout/TextBox" anchor="getText()">getText()</d:api></dt>
		<dd>Returns the text string corresponding to this node.</dd>
	</dl>
	</d:subsubsection>
	
</d:subsection>

<d:subsection id="modelElement">
<d:title>Element Boxes</d:title>
<p>An element box corresponds to a DOM node of the type <code>Element</code>. It is represented
as an object of the abstract <d:api class="org/fit/cssbox/layout/ElementBox">ElementBox</d:api>
class. It can be implemented as an inline box or a block box as described below. The common
methods of the element boxes are the following:</p>

	<d:subsubsection id="elementStructure">
	<d:title>Box Tree Structure</d:title>
	<p>Each element box may contain any number of nested sub-boxes. 
	</p>
	<dl>
		<dt><d:api class="org/fit/cssbox/layout/TextBox" anchor="getText()">getText()</d:api></dt>
		<dd>Returns the text string corresponding to this node.</dd>
	</dl>
	</d:subsubsection>
	
</d:subsection>

<d:subsection id="modelInline">
<d:title>Inline Boxes</d:title>
</d:subsection>

<d:subsection id="modelBlock">
<d:title>Block Boxes</d:title>
</d:subsection>

</d:section>

</d:document>
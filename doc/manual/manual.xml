<?xml version="1.0" encoding="UTF-8"?>
<d:document xmlns="http://www.w3.org/1999/xhtml"
		  xmlns:d="http://cssbox.sourceforge.net/docs">
<d:title>CSSBox Manual</d:title>
<d:author>Radek Burget<br/>
<a href="mailto:burgetr@fit.vutbr.cz">burgetr@fit.vutbr.cz</a>
</d:author>

<d:toc />

<d:section id="intro">
<d:title>Introduction</d:title>
<p>CSSBox is an (X)HTML/CSS rendering engine written in pure Java. Its 
primary purpose is to provide a complete and further processable information 
about the rendered page contents and layout.</p>
<p>This manual gives a short overview of the CSSBox usage. It shows how to
render a document and it explains how the resulting page is represented and
how the basic information about the individual parts can be obtained.</p>
<p>More detailed information about the individual classes can be obtained
from the <a href="../api/index.html">API documentation</a>.</p>
<p>Any feedback to CSSBox and/or this manual is welcome via the
<a href="http://cssbox.sourceforge.net/">CSSBox website</a>.</p>
</d:section>

<d:section title="Basic usage" id="basic">
<d:title>Basic usage</d:title>
<p>The input of the rendering engine is a document DOM tree. The engine is able to
automatically load the style sheets referenced in the document and it computes the
efficient style of each element. Afterwrads, the document layout is computed.</p>

<d:subsection id="basicLoading">
<d:title>Document Loading</d:title>
<p>In the examples, the <a href="http://jtidy.sourceforge.net/">JTidy</a> HTML parser
is used. However, any other DOM parser can be used. For creating the DOM tree using
JTidy, following code can be used:</p> 
<d:codebox>
<br/>Tidy tidy = new Tidy();
<br/>tidy.setTrimEmptyElements(false);
<br/>tidy.setInputEncoding("utf-8");
<br/>Document doc = tidy.parseDOM(is, null);
</d:codebox>>
<p>Note tha JTidy has many configuration options that can be found in the
documentation</p>
<p>For the initial DOM and style sheet processing, a
<d:api class="org/fit/cssbox/css/DOMAnalyzer">DOMAnalyzer</d:api> object is used:</p>
<d:codebox>
<br/>DOMAnalyzer da = new DOMAnalyzer(doc, url);
<br/>da.addStyleSheet(null, CSSNorm.stdStyleSheet()); <em>//use the standard style sheet</em>
<br/>da.addStyleSheet(null, CSSNorm.userStyleSheet()); <em>//use the additional style sheet</em>
<br/>da.getStyleSheets(); <em>//load the author style sheets</em>
<br/>da.attributesToStyles(); <em>//convert the HTML presentation attributes to inline styles</em>
</d:codebox>
<p>The <code>addStyleSheet()</code> method is used to add a style sheet to the document
where the style sheet is a text string containing a CSS code. In our case we add two
built-in style sheets that represent the standard document style. The <code>CSSNorm.stdStyleSheet()</code>
method returns the CSS default style sheet and <code>CSSNorm.userStyleSheet()</code> contains some
internal CSSBox modifications of the standard.</p>
<p>The <code>getStyleSheets()</code> method loads and processes all the internal and external
style sheets referenced from the document. In case of external style sheets, CSSBox tries to obtain
the file from the corresponding URL, if accessible.</p>
<p>Finally, the <code>attributesToStyles()</code> converts some HTML presentation attributes to CSS
styles (e.g. the <d:tag>font</d:tag> tag attributes, table attributes and some more. If the HTML
attributes need not be interpreted, this method need not be called.</p> 
<p>The resulting <code>DOMAnalyzer</code> object represents the document code together with the
associated style.</p>
</d:subsection>

<d:subsection id="basicLayout">
<d:title>Obtaining the Layout</d:title>
<p>The whole layout engine is represented by a graphical
<d:api class="org/fit/cssbox/layout/BrowserCanvas">BrowserCanvas</d:api> object. The layout is
computed automatically by creating an instance of this object. The constructor arguments are
the root DOM element (normally, it is the <d:tag>body</d:tag> element), the DOMAnalyzer used
for obtaining the element styles, the initial viewport dimensions and the document base URL used
for loading images and other referenced content.</p>
<d:codebox>
<br/>BrowserCanvas browser = new BrowserCanvas(da.getBody(), da, new java.awt.Dimension(1000, 600), url);
</d:codebox>
</d:subsection>
<p>The created <code>browser</code> object can be directly used for both displaying
the rendered document and for obtaining the created layout model.</p>

<d:subsection id="basicDisplay">
<d:title>Displaying the document</d:title>
<p>The <d:api class="org/fit/cssbox/layout/BrowserCanvas">BrowserCanvas</d:api> class is
directly derived from the Swing <code>javax.swing.JPanel</code> class. Therefore, it can
be directly used as a Swing user interface component. The size of the component is
automatically adjusted according to the resulting document layout. The basic document
displaying is shown in the <d:api class="org/fit/cssbox/demo/SimpleBrowser">SimpleBrowser</d:api>
example.</p>
</d:subsection>

</d:section> 

<d:section id="model">
<d:title>Rendered Document Model</d:title>
<!-- ziskani informaci z modelu
		- organizace stromu
		- typy uzlu
 -->
<p>The resulting document layout is represented as a tree of <dfn>boxes</dfn>. Each box
creates a rectangular area in the resulting page and it corresponds to a particular
rendered HTML element. There may be multiple boxes corresponding to a single element;
e.g. a multi-line paragraph <d:tag>p</d:tag> is split to several line boxes. A box may contain
nested boxes, a portion of the document text or a general object (e.g. an image). The root
box of the tree corresponds to the viewport, the leaf boxes correspond to the DOM text nodes
or empty elements and the remaining boxes correspond to the remaining block or inline
elements in the HTML code.</p>
<p>Each box is represented by an object which extends the
<d:api class="org/fit/cssbox/layout/Box">Box</d:api> abstract class. There exist
several box types that roughly correspond to the computed value of the CSS <code>display</code>
property for the corresponding element. Figure 1 shows the type hierarchy of boxes.</p>
<d:fig index="1" title="Box type hierarchy" src="box_classes.png" />

</d:section>

<d:section id="element">
<d:title>Element Boxes</d:title>>
<!--  -->
</d:section>

<d:section id="text">
<d:title>Text Boxes</d:title>
<!--  -->
</d:section>
</d:document>
